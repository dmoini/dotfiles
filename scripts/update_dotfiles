#!/bin/bash

source ~/.functions

CURR_DIR=$(pwd)
DOTFILES_DIR="${HOME}/code/dotfiles"
VSCODE_DIR="${HOME}/Library/Application Support/Code/User"

updateEcho() {
    echo -e "Updating $1 files"
}

# TODO: find way to copy over submodules instead of having to add them manually via this function
gitSubmoduleAdd() {
    cd $DOTFILES_DIR
    git submodule add $1 $2 &>/dev/null
    cd $CURR_DIR
}

updateGit() {
    updateEcho "Git"
    cp "${HOME}/.gitconfig" "${DOTFILES_DIR}/git"
}

updateHomebrew() {
    updateEcho "Homebrew"
    # If Brewfile already exists, delete it and create new one
    if [ -f Brewfile ]; then rm Brewfile; fi
    
    brew bundle dump
    mv Brewfile "${DOTFILES_DIR}/homebrew"
}

updateNPM() {
    updateEcho "NPM"
    # To import these packages, run `cat npm-global-packages.txt | xargs npm i -g`
    npm-global-packages > "${DOTFILES_DIR}/npm/npm-global-packages.txt"
}

updateOhMyZsh() {
    updateEcho "Oh My Zsh"
    cp "${HOME}/.zshrc" "${DOTFILES_DIR}/oh-my-zsh/"
    cp -r "${HOME}/.oh-my-zsh/custom/themes" "${DOTFILES_DIR}/oh-my-zsh/custom"

    gitSubmoduleAdd "https://github.com/MichaelAquilina/zsh-you-should-use" "oh-my-zsh/custom/plugins/you-should-use"
    gitSubmoduleAdd "https://github.com/zsh-users/zsh-syntax-highlighting" "oh-my-zsh/custom/plugins/zsh-syntax-highlighting"
}

updatePip() {
    updateEcho "Pip"
    syspip freeze > "${DOTFILES_DIR}/pip/pip-global-packages.txt"
}

updateScripts() {
    updateEcho "script"
    cp -r "${HOME}/code/scripts" "${DOTFILES_DIR}"
}

updateShell() {
    updateEcho "shell"
    cp "${HOME}/.aliases" "${HOME}/.exports" "${HOME}/.functions" "${DOTFILES_DIR}/shell"
}

updateVim() {
    updateEcho "Vim"
    cp "${HOME}/.vimrc" "${DOTFILES_DIR}/vim"
    cp -r "${HOME}/.vim/autoload" "${DOTFILES_DIR}/vim/.vim"

    gitSubmoduleAdd "https://github.com/tomasr/molokai" "vim/.vim/plugged/molokai"
    gitSubmoduleAdd "https://github.com/fmoralesc/molokayo" "vim/.vim/plugged/molokayo"
    gitSubmoduleAdd "https://github.com/micha/vim-colors-solarized" "vim/.vim/plugged/vim-colors-solarized"
    gitSubmoduleAdd "https://github.com/sickill/vim-monokai" "vim/.vim/plugged/vim-monokai"
}

updateVSCode() {
    updateEcho "VS Code"
    cp "${VSCODE_DIR}/settings.json" "${VSCODE_DIR}/keybindings.json" "${DOTFILES_DIR}/vscode"
}

updateAll() {
    updateGit
    updateHomebrew
    updateNPM
    updateOhMyZsh
    updatePip
    updateScripts
    updateShell
    updateVim
    updateVSCode
}

updateAll
